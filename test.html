<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØµØ­Ø­ Ù†ÙØ­Ø§Øª | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: sans-serif; background: #fdfaf1; text-align: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #e0d5b1; max-width: 400px; margin: auto; }
        #display { font-family: 'Amiri', serif; font-size: 3rem; color: #1a5d1a; min-height: 120px; margin: 20px 0; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 10px; }
        .matched { color: #2ecc71; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.1); }
        .not-matched { color: #ccc; }
        .btn { background: #1a5d1a; color: white; border: none; padding: 20px; border-radius: 15px; font-size: 1.3rem; width: 100%; cursor: pointer; font-weight: bold; box-shadow: 0 5px 0 #0d3d0d; }
        .recording { background: #e74c3c !important; box-shadow: 0 5px 0 #c0392b !important; }
        #status { font-size: 0.9rem; color: #7f8c8d; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color: #b8860b;">Ù…ØµØ­Ø­ Ù†ÙØ­Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h2>
    <p>Ù‚Ù„ Ø¨ÙˆØ¶ÙˆØ­: <b>(Ù‚Ù„ Ù‡Ùˆ Ø§Ù„Ù„Ù‡ Ø§Ø­Ø¯)</b></p>
    
    <div id="display">
        <span id="w0" class="not-matched">Ù‚Ù„</span>
        <span id="w1" class="not-matched">Ù‡Ùˆ</span>
        <span id="w2" class="not-matched">Ø§Ù„Ù„Ù‡</span>
        <span id="w3" class="not-matched">Ø§Ø­Ø¯</span>
    </div>
    
    <button id="btn" class="btn">ğŸ¤ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ù…ÙŠØ¹</button>
    <div id="status">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
</div>

<script>
    const btn = document.getElementById('btn');
    const status = document.getElementById('status');
    const targetWords = ["Ù‚Ù„", "Ù‡Ùˆ", "Ø§Ù„Ù„Ù‡", "Ø§Ø­Ø¯"];
    let isRecording = false;

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();

    recognition.lang = 'ar-SA';
    recognition.continuous = true;
    recognition.interimResults = true;

    btn.onclick = () => {
        if (!isRecording) {
            recognition.start();
        } else {
            recognition.stop();
        }
    };

    recognition.onstart = () => {
        isRecording = true;
        btn.classList.add('recording');
        btn.innerText = "ğŸ›‘ ØªÙˆÙ‚Ù Ø§Ù„Ø¢Ù†";
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹... Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¢Ù†";
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª
        targetWords.forEach((_, i) => document.getElementById('w'+i).className = 'not-matched');
    };

    recognition.onresult = (event) => {
        let transcript = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
            transcript += event.results[i][0].transcript;
        }

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ù†Ø·ÙˆÙ‚ Ù…Ù† Ø£ÙŠ Ø¹Ù„Ø§Ù…Ø§Øª Ø£Ùˆ Ø­Ø±ÙƒØ§Øª
        const spokenClean = transcript.replace(/[^\u0621-\u064A\s]/g, "");

        targetWords.forEach((word, index) => {
            if (spokenClean.includes(word)) {
                document.getElementById('w' + index).className = 'matched';
            }
        });

        // Ø¥Ø°Ø§ ØªÙ… Ù†Ø·Ù‚ ÙƒÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
        const allMatched = targetWords.every((_, i) => 
            document.getElementById('w'+i).classList.contains('matched')
        );

        if (allMatched) {
            status.innerText = "Ø£Ø­Ø³Ù†Øª! ØªØ³Ù…ÙŠØ¹ ØµØ­ÙŠØ­ 100%";
            setTimeout(() => { recognition.stop(); }, 1500);
        }
    };

    recognition.onend = () => {
        isRecording = false;
        btn.classList.remove('recording');
        btn.innerText = "ğŸ¤ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ù…ÙŠØ¹";
        if (status.innerText !== "Ø£Ø­Ø³Ù†Øª! ØªØ³Ù…ÙŠØ¹ ØµØ­ÙŠØ­ 100%") {
            status.innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹";
        }
    };

    recognition.onerror = (e) => {
        status.innerText = "Ø®Ø·Ø£: " + e.error;
    };
</script>

</body>
</html>
