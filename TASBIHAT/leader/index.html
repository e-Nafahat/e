<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù†ÙÙÙØ­ÙØ§ØªÙŒ Ø¥ÙÙŠÙ…ÙØ§Ù†ÙÙŠÙÙ‘Ø©ÙŒ</title>
    
    <style>
        /* ØªØ«Ø¨ÙŠØª Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙˆÙ…Ù†Ø¹ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø¬Ù„ÙŠ Ø§Ù„Ø£ÙÙ‚ */
        html, body { 
            background-color: #000000 !important; 
            overscroll-behavior: none; 
            overflow-x: hidden; /* Ù…Ù†Ø¹ Ø§Ù„Ø­Ø±ÙƒØ© ÙŠÙ…ÙŠÙ†Ø§Ù‹ ÙˆÙŠØ³Ø§Ø±Ø§Ù‹ ØªÙ…Ø§Ù…Ø§Ù‹ */
            width: 100%;
            position: fixed; /* ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„Ù…ØªØµÙØ­ */
            height: 100%;
        }

        body { 
            visibility: hidden; 
            opacity: 0; 
            margin: 0; 
            font-family: 'Cairo', sans-serif; 
            display: block !important; 
        }

        /* Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø­Ø¯ÙˆØ¯ Ø²Ø±Ù‚Ø§Ø¡ Ø£Ùˆ Ø±Ù…Ø§Ø¯ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        * {
            -webkit-tap-highlight-color: transparent;
            outline: none !important;
            box-sizing: border-box;
        }

        #main-site-content { 
            display: none; 
            opacity: 0; 
            flex-direction: column; 
            height: 100vh; 
            width: 100vw;
            transition: opacity 1.5s ease; 
            overflow: hidden;
        }

        /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±Ø© 3D --- */
        .magic-nav {
            position: fixed; top: 75px; left: 50%; transform: translateX(-50%) translateY(-20px);
            background: rgba(10, 25, 41, 0.95); backdrop-filter: blur(15px); 
            border: 1px solid rgba(179, 147, 89, 0.5);
            border-radius: 25px; display: flex; flex-direction: column; padding: 10px; gap: 8px; opacity: 0; visibility: hidden;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 10000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), inset 0 0 15px rgba(179, 147, 89, 0.1);
        }
        .magic-nav.active { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        
        .nav-item-magic { 
            color: #fff; font-size: 0.85rem; font-weight: 700; padding: 12px 25px; 
            cursor: pointer; white-space: nowrap; text-align: center;
            border-radius: 15px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(179, 147, 89, 0.2);
            transition: all 0.2s ease;
        }
        .nav-item-magic:active { 
            transform: scale(0.95); background: #b39359; color: #000; 
            box-shadow: 0 0 15px rgba(179, 147, 89, 0.5);
        }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ù…Ø·ÙˆØ± --- */
        .header-3d { 
            display: flex; justify-content: center; perspective: 1000px; 
            width: 100%; z-index: 2000; height: 55px; margin-bottom: 5px;
            background: rgba(0,0,0,0.2); padding: 0 5px;
            flex-shrink: 0;
        }
        .glass-tab {
            flex: 1; border: none; outline: none; cursor: pointer; color: rgba(255,255,255,0.8);
            font-family: 'Cairo'; font-weight: 600; font-size: 0.55rem; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px); border-radius: 0 0 15px 15px; display: flex; align-items: center; justify-content: center;
            transform: rotateX(-15deg); margin: 0 2px;
            border-bottom: 2px solid rgba(179, 147, 89, 0.3);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        
        .c-1 { background: linear-gradient(to bottom, rgba(0, 90, 80, 0.7), rgba(0, 40, 35, 0.9)); } 
        .c-2 { background: linear-gradient(to bottom, rgba(41, 128, 185, 0.7), rgba(20, 70, 110, 0.9)); } 
        .c-3 { background: linear-gradient(to bottom, rgba(184, 134, 11, 0.7), rgba(100, 70, 0, 0.9)); } 
        .c-mehrab { background: linear-gradient(to bottom, rgba(60, 60, 60, 0.7), rgba(20, 20, 20, 0.9)); } 
        .c-khatma { background: linear-gradient(to bottom, rgba(179, 147, 89, 0.7), rgba(100, 80, 40, 0.9)); } 
        .c-library { background: linear-gradient(to bottom, rgba(101, 67, 33, 0.7), rgba(50, 30, 10, 0.9)); } 
        .c-4 { background: linear-gradient(to bottom, rgba(200, 100, 40, 0.7), rgba(120, 50, 10, 0.9)); }

        .glass-tab.active { 
            height: 65px; transform: rotateX(0deg) translateY(2px); 
            font-weight: 900; z-index: 10; font-size: 0.62rem; color: #fff;
            border-bottom: 3px solid #b39359;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 10px rgba(179, 147, 89, 0.3);
        }

        .main-display { flex-grow: 1; width: 100%; position: relative; padding: 10px; box-sizing: border-box; overflow: hidden; }
        iframe { 
            position: absolute; top: 10px; left: 10px; right: 10px; bottom: 0; width: calc(100% - 20px); height: calc(100% - 10px); 
            border: none; visibility: hidden; opacity: 0; transition: opacity 0.3s ease; border-radius: 20px 20px 0 0; 
            -webkit-overflow-scrolling: touch; 
        }
        iframe.active { visibility: visible; opacity: 1; }
        #intro-holder { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; background: #000; overflow: hidden; }
    </style>
</head>
<body>

    <div id="intro-holder"></div>

    <div class="magic-nav" id="magicNav">
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('home-frame', 0)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠÙ€Ø³ÙŠØ©</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('masbaha-frame', 1)">ğŸ“¿ Ø§Ù„Ù…Ø³Ø¨Ø­Ø©</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('FrontSmart-frame', 2)">ğŸ“œ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('mehrab-frame', 3)">ğŸ’ ØªÙØ£ÙÙ…Ù‘ÙÙ„ÙØ§ØªÙŒ</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('khatma-frame', 4)">ğŸ“– Ø§Ù„Ø®ØªÙ…Ø©</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('library-frame', 5)">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø©</div>
        <div class="nav-item-magic" onclick="closeMagicAndSwitch('more-frame', 6)">âœ¨ Ø£Ø®Ø±Ù‰</div>
    </div>

    <div id="main-site-content">
        <nav class="header-3d">
            <button id="home-btn" class="glass-tab c-1 active" onclick="switchPage('home-frame', this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="glass-tab c-2" onclick="switchPage('masbaha-frame', this)">Ø§Ù„Ù…Ø³Ø¨Ø­Ø©</button>
            <button id="posts-btn" class="glass-tab c-3" onclick="switchPage('FrontSmart-frame', this)">Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</button>
            <button id="mehrab-btn" class="glass-tab c-mehrab" onclick="switchPage('mehrab-frame', this)">ØªÙØ£ÙÙ…Ù‘ÙÙ„ÙØ§ØªÙŒ</button>
            <button id="khatma-btn" class="glass-tab c-khatma" onclick="switchPage('khatma-frame', this)">Ø§Ù„Ø®ØªÙ…Ø©</button>
            <button id="lib-btn" class="glass-tab c-library" onclick="switchPage('library-frame', this)">Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
            <button id="more-btn" class="glass-tab c-4" onclick="switchPage('more-frame', this)">Ø£Ø®Ø±Ù‰</button>
        </nav>
        <div class="main-display">
            <iframe id="home-frame" src="home.html" class="active"></iframe>
            <iframe id="masbaha-frame" src="masbaha.html"></iframe>
            <iframe id="FrontSmart-frame" src="FrontSmart.html"></iframe>
            <iframe id="mehrab-frame" src="Mehrab.html?mode=full"></iframe>
            <iframe id="khatma-frame" src="khatma.html"></iframe>
            <iframe id="library-frame" src="../Library/library.html"></iframe>
            <iframe id="more-frame" src="more.html"></iframe>
        </div>
    </div>

    <script>
        let isAdmin = false;
        const globalIntroAudio = new Audio('intro11.mp3');
        globalIntroAudio.preload = 'auto';

        function executeSiteEntry() {
            const holder = document.getElementById('intro-holder');
            const mainContent = document.getElementById('main-site-content');
            mainContent.style.display = 'flex';
            sessionStorage.setItem('hasSeenIntro', 'true');
            setTimeout(() => {
                mainContent.style.opacity = '1';
                document.body.style.backgroundColor = "#F5F5DC";
            }, 100);
            setTimeout(() => { if(holder) holder.remove(); }, 1500);
        }

        window.openPost = function(postId) {
            const postsBtn = document.getElementById('posts-btn');
            const iframe = document.getElementById('FrontSmart-frame');
            switchPage('FrontSmart-frame', postsBtn);
            setTimeout(() => {
                iframe.contentWindow.postMessage({ type: 'OPEN_SPECIFIC_POST', id: postId }, '*');
            }, 600);
        };

        function switchPage(frameId, btnElement) {
            document.getElementById('magicNav').classList.remove('active');
            document.querySelectorAll('.glass-tab').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            
            if (frameId === 'masbaha-frame') document.body.style.backgroundColor = "#000000";
            else if (frameId === 'library-frame') document.body.style.backgroundColor = "#b0b0b0";
            else if (frameId === 'khatma-frame') document.body.style.backgroundColor = "#0f172a"; 
            else if (frameId === 'mehrab-frame') document.body.style.backgroundColor = "#001226"; 
            else if (frameId === 'more-frame') document.body.style.backgroundColor = "#FDFBF0";
            else document.body.style.backgroundColor = "#F5F5DC";
            
            document.querySelectorAll('iframe').forEach(f => f.classList.remove('active'));
            document.getElementById(frameId).classList.add('active');
        }

        window.addEventListener('message', function(event) {
            if (event.data === 'START_SITE_NOW') executeSiteEntry();
            if (event.data === 'TOGGLE_MENU') document.getElementById('magicNav').classList.toggle('active');
            if (event.data === 'PLAY_INTRO_AUDIO') globalIntroAudio.play().catch(e => {});
            
            if (event.data === 'OPEN_MORE_PAGE') switchPage('more-frame', document.getElementById('more-btn'));
            if (event.data === 'GO_HOME') switchPage('home-frame', document.getElementById('home-btn'));
            if (event.data === 'GO_LIBRARY') switchPage('library-frame', document.getElementById('lib-btn'));
            if (event.data === 'GO_KHATMA') switchPage('khatma-frame', document.getElementById('khatma-btn'));
            if (event.data === 'GO_MEHRAB') switchPage('mehrab-frame', document.getElementById('mehrab-btn'));

            if (event.data && (event.data.type === 'OPEN_POST' || event.data.type === 'OPEN_SPECIFIC_POST')) { 
                window.openPost(event.data.id); 
            }
        });

        document.body.style.visibility = 'visible';
        document.body.style.opacity = '1';

        if (sessionStorage.getItem('hasSeenIntro')) {
            const holder = document.getElementById('intro-holder');
            if(holder) holder.remove();
            const mainContent = document.getElementById('main-site-content');
            mainContent.style.display = 'flex';
            mainContent.style.opacity = '1';
            document.body.style.backgroundColor = "#F5F5DC";
        } else {
            fetch('intro.html')
                .then(res => res.text())
                .then(data => {
                    const holder = document.getElementById('intro-holder');
                    if(holder) {
                        holder.innerHTML = data;
                        const scripts = holder.querySelectorAll('script');
                        scripts.forEach(oldScript => {
                            const newScript = document.createElement('script');
                            newScript.text = oldScript.text;
                            document.head.appendChild(newScript).parentNode.removeChild(newScript);
                        });
                    }
                })
                .catch(err => {
                    console.warn("Intro file missing, entering site directly.");
                    executeSiteEntry();
                });
        }

        function closeMagicAndSwitch(frameId, btnIdx) {
            document.getElementById('magicNav').classList.remove('active');
            const tabs = document.querySelectorAll('.glass-tab');
            switchPage(frameId, tabs[btnIdx]);
        }
    </script>
</body>
</html>
